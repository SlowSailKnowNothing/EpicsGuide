### EPICS基础概念

EPICS指的是一套软件生态，该软件生态以EPICSBase为核心，附加其他组件，主要实现控制功能。

基于分布式标准的EPICS结构包括两部分：IOC层和OPI层。IOC层又可以细分为6层：通道访问（CA）服务器接口、数据库访问接口、动态数据库、记录支持模块、设备支持模块、设备驱动器。OPI层可以细分为两层：通道访问（CA）客户接口和应用软件。（百度百科）

上述概念做为一个基本了解就行，反正epics就是一套软件，第一步先将epicsbase安装在环境中。并配置好路径，然后run一个ioc感受一下。

[这是安装环境，runIOC的参考教程](https://blog.csdn.net/qq_34885184/article/details/88088502)

按照上面教程出错的原因可能有两个，一个是安装的epics的版本和上面的教程不同，二是路径和上面的教程不同不懂变通。

我们通过执行st.cmd跑起来的被称作IOC。IOC的全名是输入输出控制器（Input Output Controller）。可以理解为一个和设备直接打交道的部件。上层会有一个OPI层，通过CA协议来和IOC层交互。OPI和用户交互，IOC和设备交互。

IOC的核心是数据库，体现在我们的例子中是记录文件和记录定义文件。在上面的教程完成之后，我们的目录结构是这样的：

![image-20201125205634349](a-1EPICS基础概念.assets/image-20201125205634349.png)

其中，bin存放着的是二进制程序，实际上是整个程序的解释器（可以参见st.cmd）部分。

configure中最为关键的文件是RELEASE文件，存放着路径配置信息，以后再安装其他应用的时候该文件也是重点配置文件。

db文件夹存放db文件（记录文件），dbd文件夹存放dbd文件（记录定义文件），两者构成IOC的核心数据库。

iocBoot文件夹存放ioc启动的组件，核心文件是启动命令[st.cmd](#st.cmd的解释)（typro中ctrl+点击跳转）。

dbd文件一般默认生成无需我们考虑，重点关注db文件。

对于db文件，不要理解为编程，而是在做配置。db文件本身并不像传统的编程语言，有一个时间的进行顺序（通过扫描机制完成这个事情）。db文件做的事情，是配置将要使用到的**记录**。对于记录，可以用一个“方法被隐藏的”对象来类比，也可以用一张数据表来类比。

如果用对象的视角来类比，那么我们要做的事情就是，正确地配置该对象的某些属性（即指定字段值），从而使得隐藏起来的方法可以正确执行，设备可以正确地更改该对象的某些属性值（即写值到value字段中），而我们最后用上层应用OPI读取该对象的值呈现给用户。

如果用数据表的视角来类比，我们要做的事情，就是在这张表中填上正确的值（即指定字段值），从而使得隐藏起来的方法可以正确执行，设备可以将正确的值写到这张表中，而最后用OPI将这些表取出来给用户。

record(recordType, "XXXX")  +{}是记录的通用格式，一个db文件下可以建立多个记录，我们唯一需要考虑的是如何设置一个记录的字段。

记录的字段如何设置详见[这里](https://epics.anl.gov/base/R3-15/8-docs/RecordReference.html)。

这里以ai记录为例来对记录做一个简单的介绍详细见注释。

下面是一个典型的db文件的例子：

```html
record(ai, "$(user):aiExample")#这里是ai记录的类型，如果用对象的思路类比，就是该对象是一个ai类
                           #如果用数据表来类比，那么就是这张表示专门用来记录设备（或其他记录）输入的表
   {
          field(DESC, "Analog input")#描述字段，这里是描述记录的功能，不重要
          field(INP, "$(user):calcExample.VAL  NPP NMS")#重要，ai记录的输入源头，这里是其他的记录的val字段是该记录的输入源头
          field(EGUF, "10")#转换单位的最大值
          field(EGU, "Counts")#指定单位是什么，比如kg，ms，kv
          field(HOPR, "10")#指定能显示的最大值
          field(LOPR, "0")#指定能显示的最小值
          field(HIHI, "8")
          field(HIGH, "6")
          field(LOW, "4")
          field(LOLO, "2")#上面的四个字段是制定不同等级的警报限制
          field(HHSV, "MAJOR")
          field(HSV, "MINOR")
          field(LSV, "MINOR")
          field(LLSV, "MAJOR")#暂时不懂
 }

```

可以看到，其实记录本身只是对属性的配置，IOC的具体功能实现是底层的代码来实现的。因为IOC的核心是数据库，但是IOC本身不仅仅是数据库，IOC还包括数据库访问例程，扫描机制，记录支持，设备驱动，数据监视器，序列器。